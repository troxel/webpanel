Steps taken to harden PI's 

1) Disabled unnecessary units 

systemctl disable rsyslog <- start to debug log is lost on reboot 
systemctl disable alsa-restore 
systemctl stop apt-daily.timer 
systemctl disable apt-daily.timer 
systemctl mask apt-daily.service 
systemctl disable avahi-daemon.service 
systemctl disable avahi-daemon.socket 

systemctl daemon-reload 


2) Take care of sneaky crontabs 

>mkdir cron.daily/attic 
>mv cron.daily ./attic/ 

3) Set IP static 

edit /etc/dhcpcd.conf 

Don't use the /etc/network/interfaces 


4) Configured iptables 

>apt-get install iptables-persistent 

Configured iptables to drop everything but 22,80,8080 and redirect 80 -> 8080 

# Generated by iptables-save v1.6.0 on Fri Jun 29 15:55:32 2018 
*nat 
:PREROUTING ACCEPT [2:592] 
:INPUT ACCEPT [0:0] 
:OUTPUT ACCEPT [1:76] 
:POSTROUTING ACCEPT [1:76] 
-A PREROUTING -i eth0 -p tcp -m tcp --dport 80 -j DNAT --to-destination :8080 
COMMIT 
# Completed on Fri Jun 29 15:55:32 2018 
# Generated by iptables-save v1.6.0 on Fri Jun 29 15:55:32 2018 
*filter 
:INPUT DROP [0:0] 
:FORWARD DROP [0:0] 
:OUTPUT ACCEPT [0:0] 
-A INPUT -i lo -j ACCEPT 
-A INPUT -d 127.0.0.0/8 ! -i lo -j REJECT --reject-with icmp-port-unreachable 
-A INPUT -m state --state RELATED,ESTABLISHED -j ACCEPT 
-A INPUT -p tcp -m state --state NEW -m tcp --dport 22 -j ACCEPT 
-A INPUT -p tcp -m state --state NEW -m tcp --dport 8080 -j ACCEPT 
-A INPUT -j REJECT --reject-with icmp-port-unreachable 
-A FORWARD -j REJECT --reject-with icmp-port-unreachable 
-A OUTPUT -j ACCEPT 
COMMIT 
# Completed on Fri Jun 29 15:55:32 2018 


5) Edit /etc/fstab 

proc /proc proc defaults 0 0 
PARTUUID=84ec088e-01 /boot vfat defaults 0 2 
PARTUUID=84ec088e-02 / ext4 defaults,noatime,ro 0 1 

# Save the sd card 
tmpfs /tmp tmpfs defaults,noatime,nosuid,size=5m 0 0 
tmpfs /var/log tmpfs defaults,noatime,nosuid,size=20m 0 0 

Notice root fs is ro 

To make edits 

>mount / -o rw,remount 
